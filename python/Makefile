# FPT University Agent - Refactored Makefile

.PHONY: help install install-dev demo demo-simple test clean docker-build docker-run format lint type-check

# Default target
help:
	@echo "ğŸŒ¸ FPT University Agent - Refactored"
	@echo "Available commands:"
	@echo ""
	@echo "  ğŸ“¦ Setup:"
	@echo "    install      - Install production dependencies"
	@echo "    install-dev  - Install development dependencies"
	@echo ""
	@echo "  ğŸš€ Demo:"
	@echo "    demo         - Run full intent detection demo"
	@echo "    demo-simple  - Run simple functionality test"
	@echo ""
	@echo "  ğŸ§ª Testing:"
	@echo "    test         - Run tests (when implemented)"
	@echo "    test-cov     - Run tests with coverage"
	@echo ""
	@echo "  ğŸ”§ Development:"
	@echo "    format       - Format code with black"
	@echo "    lint         - Lint code with flake8"
	@echo "    type-check   - Type check with mypy"
	@echo "    clean        - Clean cache and temp files"
	@echo ""
	@echo "  ğŸ³ Docker:"
	@echo "    docker-build - Build Docker image"
	@echo "    docker-run   - Run with Docker Compose"
	@echo "    docker-dev   - Run development environment"
	@echo "    docker-stop  - Stop Docker services"

# Installation
install:
	@echo "ğŸ“¦ Installing production dependencies..."
	pip install -r requirements.txt

install-dev:
	@echo "ğŸ“¦ Installing development dependencies..."
	pip install -r requirements-dev.txt

# Demo commands
demo:
	@echo "ğŸš€ Running optimized intent detection demo..."
	python optimized_demo.py

demo-simple:
	@echo "ğŸš€ Running simple functionality test..."
	python optimized_demo.py

# Testing
test:
	@echo "ğŸ§ª Running tests..."
	@echo "âš ï¸  Tests not implemented yet. Run demo instead:"
	@echo "    make demo"

test-cov:
	@echo "ğŸ§ª Running tests with coverage..."
	@echo "âš ï¸  Tests not implemented yet."

# Development tools
format:
	@echo "ğŸ¨ Formatting code with black..."
	black src/ optimized_demo.py

lint:
	@echo "ğŸ” Linting code with flake8..."
	flake8 src/ optimized_demo.py --max-line-length=100 --ignore=E203,W503

type-check:
	@echo "ğŸ” Type checking with mypy..."
	mypy src/ --ignore-missing-imports

clean:
	@echo "ğŸ§¹ Cleaning cache and temp files..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete 2>/dev/null || true
	find . -type f -name "*.pyo" -delete 2>/dev/null || true
	find . -type d -name "*.egg-info" -exec rm -rf {} + 2>/dev/null || true
	rm -rf .pytest_cache/ .mypy_cache/ .coverage htmlcov/ 2>/dev/null || true
	@echo "âœ… Cleanup completed"

# Docker commands
docker-build:
	@echo "ğŸ³ Building Docker image..."
	docker build -t fpt-agent-refactored .

docker-run:
	@echo "ğŸ³ Running with Docker Compose..."
	docker-compose up -d

docker-dev:
	@echo "ğŸ³ Running development environment..."
	docker-compose --profile dev up

docker-stop:
	@echo "ğŸ³ Stopping Docker services..."
	docker-compose down

# Development workflow
dev-setup: install-dev
	@echo "ğŸ”§ Setting up development environment..."
	cp .env.example .env
	@echo "âœ… Development setup completed"
	@echo "ğŸ“ Please edit .env file with your configuration"

dev-check: format lint type-check
	@echo "âœ… Development checks completed"

# Quick start
quick-start: install demo
	@echo "ğŸ‰ Quick start completed!"

# Production deployment
deploy-check:
	@echo "ğŸš€ Checking production readiness..."
	@echo "âœ… Docker image: fpt-agent-refactored"
	@echo "âœ… Environment: Check .env file"
	@echo "âœ… Dependencies: requirements.txt"
	@echo "âœ… Health check: /health endpoint"

# Show project structure
structure:
	@echo "ğŸ“ Project structure:"
	@tree -I '__pycache__|*.pyc|.git|.env' -L 3 .
